<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Course Generator - React</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        border: "hsl(217.2 32.6% 17.5%)",
                        background: "hsl(222.2 84% 4.9%)",
                        foreground: "hsl(210 40% 98%)",
                        primary: {
                            DEFAULT: "hsl(210 40% 98%)",
                            foreground: "hsl(222.2 84% 4.9%)",
                        },
                        secondary: {
                            DEFAULT: "hsl(217.2 32.6% 17.5%)",
                            foreground: "hsl(210 40% 98%)",
                        },
                        muted: {
                            DEFAULT: "hsl(217.2 32.6% 17.5%)",
                            foreground: "hsl(215 20.2% 65.1%)",
                        },
                    }
                }
            }
        }
    </script>
    
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <style>
        body {
            font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
        }
    </style>
</head>
<body class="dark bg-background text-foreground min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        // Simple icon components using emoji
        const Youtube = ({ className }) => React.createElement('span', { className: className || 'w-6 h-6 text-2xl' }, '📺');
        const Send = ({ className }) => React.createElement('span', { className: className || 'w-4 h-4' }, '→');
        const Clock = ({ className }) => React.createElement('span', { className: className || 'w-4 h-4' }, '⏱️');
        const CheckCircle2 = ({ className }) => React.createElement('span', { className: className || 'w-5 h-5' }, '✅');
        const AlertCircle = ({ className }) => React.createElement('span', { className: className || 'w-5 h-5' }, '⚠️');
        const Download = ({ className }) => React.createElement('span', { className: className || 'w-4 h-4' }, '⬇️');
        
        // API Configuration
        const API_BASE = window.location.origin;
        
        // Socket.io setup
        const socket = io(API_BASE);
        
        // Navigation Component
        const Navigation = () => {
            const [currentPage, setCurrentPage] = useState('home');
            
            return (
                <nav className="bg-gradient-to-r from-purple-600 to-indigo-600 p-4 mb-8 rounded-lg">
                    <div className="container mx-auto flex items-center justify-between">
                        <div className="flex items-center space-x-2">
                            <Youtube className="w-8 h-8 text-white" />
                            <h1 className="text-2xl font-bold text-white">Course Generator</h1>
                        </div>
                        <div className="flex space-x-4">
                            <button 
                                onClick={() => setCurrentPage('home')}
                                className={`px-4 py-2 rounded-lg transition-colors ${
                                    currentPage === 'home' 
                                        ? 'bg-white text-purple-600' 
                                        : 'text-white hover:bg-white/20'
                                }`}
                            >
                                Home
                            </button>
                            <button 
                                onClick={() => setCurrentPage('courses')}
                                className={`px-4 py-2 rounded-lg transition-colors ${
                                    currentPage === 'courses' 
                                        ? 'bg-white text-purple-600' 
                                        : 'text-white hover:bg-white/20'
                                }`}
                            >
                                My Courses
                            </button>
                        </div>
                    </div>
                </nav>
            );
        };
        
        // Home Page Component
        const HomePage = () => {
            const [url, setUrl] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [progress, setProgress] = useState([]);
            const [currentCourse, setCurrentCourse] = useState(null);
            
            useEffect(() => {
                socket.on('processing_update', (data) => {
                    setProgress(prev => [...prev, data]);
                });
                
                socket.on('course_completed', (data) => {
                    setCurrentCourse(data.course);
                    setIsGenerating(false);
                });
                
                socket.on('processing_error', (data) => {
                    console.error('Processing error:', data);
                    setIsGenerating(false);
                });
                
                return () => {
                    socket.off('processing_update');
                    socket.off('course_completed');
                    socket.off('processing_error');
                };
            }, []);
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!url.trim()) return;
                
                setIsGenerating(true);
                setProgress([]);
                setCurrentCourse(null);
                
                try {
                    const response = await axios.post(`${API_BASE}/api/generate-course`, {
                        youtube_url: url
                    });
                    
                    if (response.data.success) {
                        console.log('Course generation started:', response.data.session_id);
                    }
                } catch (error) {
                    console.error('Error starting course generation:', error);
                    setIsGenerating(false);
                }
            };
            
            return (
                <div className="container mx-auto max-w-4xl px-4">
                    <div className="text-center mb-12">
                        <h2 className="text-4xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-indigo-400 bg-clip-text text-transparent">
                            Transform YouTube Videos into Structured Courses
                        </h2>
                        <p className="text-muted-foreground text-lg">
                            AI-powered course generation with real-time progress tracking
                        </p>
                    </div>
                    
                    <form onSubmit={handleSubmit} className="mb-8">
                        <div className="flex gap-4">
                            <input
                                type="url"
                                value={url}
                                onChange={(e) => setUrl(e.target.value)}
                                placeholder="Enter YouTube URL..."
                                className="flex-1 px-4 py-3 bg-secondary border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                                disabled={isGenerating}
                                required
                            />
                            <button
                                type="submit"
                                disabled={isGenerating || !url.trim()}
                                className="px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"
                            >
                                {isGenerating ? (
                                    <>
                                        <Clock className="w-4 h-4 animate-spin" />
                                        <span>Generating...</span>
                                    </>
                                ) : (
                                    <>
                                        <Send className="w-4 h-4" />
                                        <span>Generate Course</span>
                                    </>
                                )}
                            </button>
                        </div>
                    </form>
                    
                    {/* Progress Updates */}
                    {isGenerating && progress.length > 0 && (
                        <div className="bg-secondary rounded-lg p-6 mb-8">
                            <h3 className="text-xl font-semibold mb-4 flex items-center">
                                <Clock className="w-5 h-5 mr-2 animate-spin" />
                                Processing Progress
                            </h3>
                            <div className="space-y-3">
                                {progress.map((step, index) => (
                                    <div key={index} className="flex items-center space-x-3 p-3 bg-background rounded-lg">
                                        <CheckCircle2 className="w-5 h-5 text-green-500" />
                                        <div>
                                            <p className="font-medium">{step.step}</p>
                                            <p className="text-sm text-muted-foreground">{step.message}</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                    
                    {/* Course Result */}
                    {currentCourse && (
                        <div className="bg-secondary rounded-lg p-6">
                            <h3 className="text-2xl font-bold mb-4 flex items-center">
                                <CheckCircle2 className="w-6 h-6 text-green-500 mr-2" />
                                Course Generated Successfully!
                            </h3>
                            
                            <div className="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h4 className="text-xl font-semibold mb-3">{currentCourse.title}</h4>
                                    <p className="text-muted-foreground mb-4">{currentCourse.description}</p>
                                    
                                    <div className="space-y-2">
                                        <p><strong>Duration:</strong> {currentCourse.duration}</p>
                                        <p><strong>Quality Score:</strong> {currentCourse.quality_score}</p>
                                        <p><strong>Processing Time:</strong> {currentCourse.processing_time}s</p>
                                    </div>
                                    
                                    {currentCourse.mp4_video_path && (
                                        <div className="mt-4">
                                            <a 
                                                href={`${API_BASE}/video/${currentCourse.mp4_video_path.split('/').pop()}`}
                                                className="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                            >
                                                <Download className="w-4 h-4 mr-2" />
                                                Download Video
                                            </a>
                                        </div>
                                    )}
                                </div>
                                
                                <div>
                                    <h5 className="font-semibold mb-3">7-Day Learning Plan:</h5>
                                    <div className="space-y-2 max-h-80 overflow-y-auto">
                                        {currentCourse.content && currentCourse.content.split('Day ').slice(1).map((day, index) => (
                                            <div key={index} className="p-3 bg-background rounded-lg">
                                                <h6 className="font-medium text-purple-400">Day {index + 1}</h6>
                                                <p className="text-sm text-muted-foreground">{day.substring(0, 100)}...</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        // Courses Page Component
        const CoursesPage = () => {
            const [courses, setCourses] = useState([]);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                const fetchCourses = async () => {
                    try {
                        const response = await axios.get(`${API_BASE}/api/courses`);
                        setCourses(response.data.courses || []);
                    } catch (error) {
                        console.error('Error fetching courses:', error);
                    } finally {
                        setLoading(false);
                    }
                };
                
                fetchCourses();
            }, []);
            
            if (loading) {
                return (
                    <div className="container mx-auto max-w-4xl px-4 text-center">
                        <Clock className="w-8 h-8 animate-spin mx-auto mb-4" />
                        <p>Loading courses...</p>
                    </div>
                );
            }
            
            return (
                <div className="container mx-auto max-w-4xl px-4">
                    <h2 className="text-3xl font-bold mb-8">My Courses</h2>
                    
                    {courses.length === 0 ? (
                        <div className="text-center py-12">
                            <AlertCircle className="w-12 h-12 text-muted-foreground mx-auto mb-4" />
                            <h3 className="text-xl font-semibold mb-2">No courses yet</h3>
                            <p className="text-muted-foreground">Generate your first course to get started!</p>
                        </div>
                    ) : (
                        <div className="grid gap-6">
                            {courses.map((course) => (
                                <div key={course.id} className="bg-secondary rounded-lg p-6">
                                    <div className="flex justify-between items-start mb-4">
                                        <div>
                                            <h3 className="text-xl font-semibold mb-2">{course.title}</h3>
                                            <p className="text-muted-foreground">{course.description}</p>
                                        </div>
                                        <span className="px-2 py-1 bg-purple-600 text-white text-sm rounded">
                                            {course.quality_score}
                                        </span>
                                    </div>
                                    
                                    <div className="flex justify-between items-center text-sm text-muted-foreground">
                                        <span>Created: {new Date(course.created_at).toLocaleDateString()}</span>
                                        <span>Duration: {course.duration}</span>
                                    </div>
                                    
                                    {course.mp4_video_path && (
                                        <div className="mt-4">
                                            <a 
                                                href={`${API_BASE}/video/${course.mp4_video_path.split('/').pop()}`}
                                                className="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                            >
                                                <Download className="w-4 h-4 mr-2" />
                                                Download Video
                                            </a>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };
        
        // Main App Component
        const App = () => {
            const [currentPage, setCurrentPage] = useState('home');
            
            return (
                <div className="min-h-screen bg-background">
                    <div className="container mx-auto px-4 py-8">
                        <Navigation currentPage={currentPage} setCurrentPage={setCurrentPage} />
                        
                        {currentPage === 'home' && <HomePage />}
                        {currentPage === 'courses' && <CoursesPage />}
                    </div>
                </div>
            );
        };
        
        // Render the App using React 18 createRoot
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
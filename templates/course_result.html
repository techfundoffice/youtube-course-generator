<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Generated - YouTube Course Generator</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Video.js CSS for better video player -->
    <link href="https://vjs.zencdn.net/8.7.0/video.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark mb-4" style="background: linear-gradient(135deg, #6f42c1, #6610f2); border-radius: 10px;">
            <div class="container-fluid">
                <a class="navbar-brand" href="/">
                    <i class="fas fa-youtube me-2"></i>Course Generator
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse show" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="/">
                                <i class="fas fa-home me-1"></i>Course Generator
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/courses">
                                <i class="fas fa-list me-1"></i>Generated Courses
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/tests">
                                <i class="fas fa-vial me-1"></i>Test Dashboard
                            </a>
                        </li>
                    </ul>
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="/api/stats">
                                <i class="fas fa-chart-bar me-1"></i>API Stats
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/">
                                <i class="fas fa-plus me-1"></i>New Course
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <header class="text-center py-4 border-bottom">
            <h1 class="h3">
                <i class="fas fa-graduation-cap text-primary me-2"></i>
                Course Generated Successfully
            </h1>
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mt-2">
                <ol class="breadcrumb justify-content-center">
                    <li class="breadcrumb-item"><a href="/">Course Generator</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Course Result</li>
                </ol>
            </nav>
        </header>

        <main class="py-4">
            <!-- Processing Metrics -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-success">
                        <div class="card-header bg-success">
                            <h5 class="card-title mb-0 text-white">
                                <i class="fas fa-check-circle me-2"></i>
                                Course Generated Successfully
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3 text-center">
                                    <div class="metric-box">
                                        <h4 class="text-success">{{ quality_score }}</h4>
                                        <small class="text-muted">Quality Grade</small>
                                    </div>
                                </div>
                                <div class="col-md-3 text-center">
                                    <div class="metric-box">
                                        <h4 class="text-info">{{ "%.1f"|format(metrics.processing_time) }}s</h4>
                                        <small class="text-muted">Processing Time</small>
                                    </div>
                                </div>
                                <div class="col-md-3 text-center">
                                    <div class="metric-box">
                                        <h4 class="text-warning">${{ "%.4f"|format(metrics.total_cost) }}</h4>
                                        <small class="text-muted">Total Cost</small>
                                    </div>
                                </div>
                                <div class="col-md-3 text-center">
                                    <div class="metric-box">
                                        <h4 class="text-primary">{{ "%.1f"|format(metrics.overall_success_rate * 100) }}%</h4>
                                        <small class="text-muted">Success Rate</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Course Overview -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title mb-0">
                                <i class="fas fa-book-open me-2"></i>
                                {{ course.course_title }}
                            </h4>
                        </div>
                        <div class="card-body">
                            <p class="card-text">{{ course.course_description }}</p>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <strong>Target Audience:</strong> {{ course.target_audience }}<br>
                                    <strong>Difficulty Level:</strong> {{ course.difficulty_level }}
                                </div>
                                <div class="col-md-6">
                                    <strong>Estimated Total Time:</strong> {{ course.estimated_total_time }}<br>
                                    <strong>Number of Days:</strong> {{ course.days|length }} days
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- YouTube Video Embed -->
            {% if course.video_id %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title mb-0">
                                <i class="fab fa-youtube text-danger me-2"></i>
                                YouTube Video URL
                            </h4>
                        </div>
                        <div class="card-body">
                            <div class="ratio ratio-16x9">
                                <iframe 
                                    src="https://www.youtube.com/embed/{{ course.video_id }}" 
                                    frameborder="0" 
                                    allowfullscreen
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                                </iframe>
                            </div>
                            <div class="mt-3">
                                <a href="{{ course.youtube_url }}" class="btn btn-outline-secondary btn-sm" target="_blank" rel="noopener noreferrer">
                                    <i class="fab fa-youtube me-1"></i>View on YouTube
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- MP4 Video Display -->
            {% if video_info.mp4_video_url %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title mb-0">
                                <i class="fas fa-video me-2"></i>
                                Original Video
                            </h4>
                        </div>
                        <div class="card-body">
                            <!-- Premium Storage Indicator -->
                            {% if video_info.cloudinary_url %}
                            <div class="alert alert-info mb-3">
                                <i class="fas fa-cloud me-2"></i>
                                <strong>Premium Storage:</strong> This video is stored in Cloudinary premium cloud storage for persistent access.
                            </div>
                            {% endif %}
                            
                            <div class="ratio ratio-16x9">
                                <video 
                                    id="course-video" 
                                    class="video-js vjs-default-skin rounded"
                                    controls 
                                    preload="auto" 
                                    width="100%" 
                                    height="100%"
                                    data-setup='{"responsive": true, "fluid": true}'
                                    poster="{{ video_info.cloudinary_thumbnail or '' }}">
                                    <!-- Use Cloudinary URL if available, otherwise fall back to local -->
                                    {% if video_info.cloudinary_url %}
                                    <source src="{{ video_info.cloudinary_url }}" type="video/mp4" />
                                    {% else %}
                                    <source src="{{ video_info.mp4_video_url }}" type="video/mp4" />
                                    {% endif %}
                                    <p class="vjs-no-js">
                                        To view this video please enable JavaScript, and consider upgrading to a web browser that
                                        <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>.
                                    </p>
                                </video>
                            </div>
                            <div class="mt-3">
                                <div class="row">
                                    <div class="col-md-6">
                                        <small class="text-muted">
                                            <i class="fas fa-download me-1"></i>
                                            Download Status: 
                                            <span class="badge bg-success">{{ video_info.mp4_download_status|title }}</span>
                                        </small>
                                    </div>
                                    {% if video_info.mp4_file_size %}
                                    <div class="col-md-6">
                                        <small class="text-muted">
                                            <i class="fas fa-file me-1"></i>
                                            File Size: {{ "%.1f"|format(video_info.mp4_file_size / 1024 / 1024) }} MB
                                        </small>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="mt-2">
                                    <a href="/download/{{ course.id }}" class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-download me-1"></i>Download Video
                                    </a>
                                    <a href="{{ course.youtube_url }}" class="btn btn-outline-secondary btn-sm ms-2" target="_blank" rel="noopener noreferrer">
                                        <i class="fab fa-youtube me-1"></i>View on YouTube
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <!-- Debug Info: No MP4 Video Available -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>MP4 Video Not Available</strong>
                        <p class="mb-0 mt-2">The MP4 video download may have failed or is still in progress. The course content is available below.</p>
                        <div class="mt-3">
                            <a href="{{ course.youtube_url }}" class="btn btn-outline-primary btn-sm" target="_blank" rel="noopener noreferrer">
                                <i class="fab fa-youtube me-1"></i>View on YouTube
                            </a>
                        </div>
                        <small class="text-muted mt-2 d-block">
                            Debug info: mp4_video_url = "{{ video_info.mp4_video_url|default('Not set') }}", 
                            mp4_download_status = "{{ video_info.mp4_download_status|default('Not set') }}"
                            {% if video_info.run_id %}, run_id = "{{ video_info.run_id }}"{% endif %}
                        </small>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Processing Logs Output Window -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h4 class="card-title mb-0">
                                <i class="fas fa-terminal me-2"></i>Processing Output Logs
                            </h4>
                            <div>
                                <button class="btn btn-outline-light btn-sm" id="clearLogsBtn">
                                    <i class="fas fa-trash me-1"></i>Clear
                                </button>
                                <button class="btn btn-outline-light btn-sm" id="toggleAutoScrollBtn">
                                    <i class="fas fa-arrow-down me-1"></i>Auto-scroll
                                </button>
                                <button class="btn btn-outline-light btn-sm" id="refreshLogsBtn">
                                    <i class="fas fa-sync-alt me-1"></i>Refresh
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div id="logOutput" class="live-logs-content" style="background: #1e1e24; color: #e9ecef; font-family: 'SF Mono', 'Monaco', 'Consolas', monospace; font-size: 0.8rem; line-height: 1.4; max-height: 400px; overflow-y: auto; padding: 1rem; border-radius: 0 0 0.375rem 0.375rem;">
                                <div class="text-muted">
                                    <i class="fas fa-info-circle me-2"></i>Real-time processing logs from course generation:
                                </div>
                                <div class="mt-3" id="processingLogs">
                                    {% if processing_logs and processing_logs|length > 0 %}
                                        {% for log in processing_logs %}
                                        <div class="log-entry">
                                            <span class="log-timestamp text-secondary">{{ log.timestamp[:19] if log.timestamp else 'N/A' }}</span>
                                            <span class="log-message {% if log.level == 'ERROR' %}text-danger{% elif log.level == 'WARNING' %}text-warning{% elif log.status == 'SUCCESS' %}text-success{% elif log.status == 'FAILED' %}text-danger{% elif log.status == 'RUNNING' %}text-primary{% else %}text-info{% endif %}">
                                                <i class="fas fa-{% if log.level == 'ERROR' %}exclamation-triangle{% elif log.level == 'WARNING' %}exclamation-circle{% elif log.status == 'SUCCESS' %}check{% elif log.status == 'FAILED' %}times{% elif log.status == 'RUNNING' %}clock{% elif log.step == 'MP4 Download' %}download{% elif log.step == 'AI Course Generation' %}brain{% elif log.step == 'Transcript Extraction' %}file-alt{% elif log.step == 'Video Metadata' %}video{% else %}info-circle{% endif %} me-1"></i>
                                                {{ log.step }}: {{ log.status }}{% if log.details %} - {{ log.details }}{% endif %}
                                            </span>
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="log-entry">
                                            <span class="log-timestamp text-secondary">2025-07-18T04:20:00</span>
                                            <span class="log-message text-warning">
                                                <i class="fas fa-exclamation-triangle me-1"></i>No processing logs available for this session
                                            </span>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- URL Comparison Dataframe -->
            {% if course.youtube_url and video_info.mp4_video_url %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title mb-0">
                                <i class="fas fa-link me-2"></i>
                                URL Comparison Table
                            </h4>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-dark table-striped">
                                    <thead>
                                        <tr>
                                            <th scope="col">Source Type</th>
                                            <th scope="col">URL</th>
                                            <th scope="col">Status</th>
                                            <th scope="col">File Size</th>
                                            <th scope="col">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <i class="fab fa-youtube text-danger me-2"></i>
                                                <strong>Original YouTube</strong>
                                            </td>
                                            <td>
                                                <code class="small">{{ course.youtube_url }}</code>
                                            </td>
                                            <td>
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check me-1"></i>Active
                                                </span>
                                            </td>
                                            <td>
                                                <span class="text-muted">Streaming</span>
                                            </td>
                                            <td>
                                                <a href="{{ course.youtube_url }}" class="btn btn-outline-danger btn-sm" target="_blank">
                                                    <i class="fab fa-youtube me-1"></i>Watch
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <i class="fas fa-download text-primary me-2"></i>
                                                <strong>Downloaded MP4</strong>
                                            </td>
                                            <td>
                                                <code class="small">{{ video_info.mp4_video_url }}</code>
                                            </td>
                                            <td>
                                                {% if video_info.mp4_download_status == 'completed_fallback' %}
                                                <span class="badge bg-warning">
                                                    <i class="fas fa-shield-alt me-1"></i>Completed (Fallback System)
                                                </span>
                                                {% elif video_info.mp4_download_status == 'completed' %}
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check me-1"></i>{{ video_info.mp4_download_status|title|default('Available') }}
                                                </span>
                                                {% else %}
                                                <span class="badge bg-secondary">
                                                    <i class="fas fa-info me-1"></i>{{ video_info.mp4_download_status|title|default('Available') }}
                                                </span>
                                                {% endif %}
                                                {% if video_info.source == 'youtube-downloader' %}
                                                <br><small class="text-warning"><i class="fas fa-info-circle me-1"></i>Free fallback system used</small>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if video_info.mp4_file_size %}
                                                <span class="text-info">{{ "%.1f"|format(video_info.mp4_file_size / 1024 / 1024) }} MB</span>
                                                {% else %}
                                                <span class="text-muted">Unknown</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <a href="{{ video_info.mp4_video_url }}" class="btn btn-outline-primary btn-sm" target="_blank" download>
                                                    <i class="fas fa-download me-1"></i>Download
                                                </a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- YouTube Video Embed -->
                            <div class="mt-4">
                                <h5 class="mb-3">
                                    <i class="fab fa-youtube text-danger me-2"></i>
                                    Original YouTube Video
                                </h5>
                                {% set youtube_id = course.youtube_url.split('watch?v=')[1].split('&')[0] if 'watch?v=' in course.youtube_url else course.youtube_url.split('/')[-1] %}
                                <div class="ratio ratio-16x9">
                                    <iframe 
                                        src="https://www.youtube.com/embed/{{ youtube_id }}" 
                                        title="YouTube video player" 
                                        frameborder="0" 
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                        allowfullscreen
                                        class="rounded">
                                    </iframe>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>URL Comparison:</strong> The original YouTube URL provides streaming access, while the MP4 URL offers a direct download of the video file for offline viewing and course integration.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Cloudinary Premium Storage Status -->
            {% if video_info.cloudinary_url or video_info.cloudinary_upload_status or video_info.mp4_video_url %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-info">
                        <div class="card-header bg-info text-white">
                            <h4 class="card-title mb-0">
                                <i class="fas fa-cloud me-2"></i>
                                Premium Cloud Storage Status
                            </h4>
                        </div>
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    {% if video_info.cloudinary_url %}
                                    <div class="alert alert-success mb-3">
                                        <i class="fas fa-cloud-upload-alt me-2"></i>
                                        <strong>Success!</strong> Video stored in Cloudinary premium cloud storage for permanent access.
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <strong>Cloud URL:</strong><br>
                                            <code class="small">{{ video_info.cloudinary_url }}</code>
                                        </div>
                                        <div class="col-md-6">
                                            <strong>Public ID:</strong><br>
                                            <code class="small">{{ video_info.cloudinary_public_id }}</code>
                                        </div>
                                    </div>
                                    {% elif video_info.cloudinary_upload_status == 'failed' %}
                                    <div class="alert alert-warning mb-3">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <strong>Upload Failed:</strong> Video stored locally only. Premium storage upload encountered an error.
                                    </div>
                                    {% else %}
                                    <div class="alert alert-info mb-3">
                                        <i class="fas fa-clock me-2"></i>
                                        <strong>Processing:</strong> Video upload to premium storage in progress...
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4 text-center">
                                    <div class="premium-storage-badge">
                                        {% if video_info.cloudinary_url %}
                                        <div class="badge-icon text-success mb-2">
                                            <i class="fas fa-cloud-upload-alt" style="font-size: 3rem;"></i>
                                        </div>
                                        <div class="badge bg-success">
                                            <i class="fas fa-check me-1"></i>Premium Storage Active
                                        </div>
                                        {% elif video_info.cloudinary_upload_status == 'failed' %}
                                        <div class="badge-icon text-warning mb-2">
                                            <i class="fas fa-cloud-exclamation-alt" style="font-size: 3rem;"></i>
                                        </div>
                                        <div class="badge bg-warning">
                                            <i class="fas fa-exclamation-triangle me-1"></i>Upload Failed
                                        </div>
                                        {% else %}
                                        <div class="badge-icon text-info mb-2">
                                            <i class="fas fa-cloud-arrow-up" style="font-size: 3rem;"></i>
                                        </div>
                                        <div class="badge bg-info">
                                            <i class="fas fa-clock me-1"></i>Processing
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            {% if video_info.cloudinary_thumbnail %}
                            <div class="mt-3">
                                <strong>Generated Thumbnail:</strong><br>
                                <img src="{{ video_info.cloudinary_thumbnail }}" alt="Video Thumbnail" class="img-thumbnail" style="max-width: 200px;">
                            </div>
                            {% endif %}
                            
                            <div class="mt-3">
                                <div class="row">
                                    <div class="col-md-6">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Premium storage provides persistent video access, global CDN delivery, and automatic optimization.
                                        </small>
                                    </div>
                                    <div class="col-md-6 text-end">
                                        {% if video_info.cloudinary_url %}
                                        <a href="{{ video_info.cloudinary_url }}" class="btn btn-outline-info btn-sm" target="_blank">
                                            <i class="fas fa-external-link-alt me-1"></i>View Cloud Video
                                        </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Daily Course Structure - All Sections Expanded -->
            <div class="row mb-4">
                <div class="col-12">
                    <h3 class="mb-3">
                        <i class="fas fa-calendar-alt me-2"></i>
                        7-Day Course Structure
                    </h3>
                    
                    <!-- Course Days - All Expanded by Default -->
                    <div id="courseStructure">
                        {% for day in course.days %}
                        <div class="card mb-4 course-day-card" data-day="{{ day.day }}">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h4 class="card-title mb-0">
                                        <i class="fas fa-calendar-day me-2 text-primary"></i>
                                        {{ day.title }}
                                    </h4>
                                    <span class="badge bg-info">{{ day.estimated_time }}</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-4">
                                            <h6 class="text-success">
                                                <i class="fas fa-bullseye me-2"></i>Learning Objectives
                                            </h6>
                                            <ul class="list-group list-group-flush">
                                                {% for objective in day.objectives %}
                                                <li class="list-group-item bg-transparent border-0 px-0 py-1">
                                                    <i class="fas fa-check text-success me-2"></i>{{ objective }}
                                                </li>
                                                {% endfor %}
                                            </ul>
                                        </div>

                                        <div class="mb-4">
                                            <h6 class="text-warning">
                                                <i class="fas fa-lightbulb me-2"></i>Key Takeaways
                                            </h6>
                                            <ul class="list-group list-group-flush">
                                                {% for takeaway in day.key_takeaways %}
                                                <li class="list-group-item bg-transparent border-0 px-0 py-1">
                                                    <i class="fas fa-star text-warning me-2"></i>{{ takeaway }}
                                                </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="mb-4">
                                            <h6 class="text-info">
                                                <i class="fas fa-tasks me-2"></i>Daily Activities
                                            </h6>
                                            <div class="list-group">
                                                {% for activity in day.activities %}
                                                <div class="list-group-item bg-dark mb-2 border-secondary">
                                                    <div class="d-flex justify-content-between align-items-start">
                                                        <div class="flex-grow-1">
                                                            <h6 class="mb-1 text-primary">
                                                                <i class="fas fa-play me-2"></i>
                                                                {{ activity.type|title }}
                                                            </h6>
                                                            <p class="mb-0 small">{{ activity.description }}</p>
                                                        </div>
                                                        <span class="badge bg-secondary ms-2">{{ activity.time_estimate }}</span>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>

                                        {% if day.homework %}
                                        <div class="mb-4">
                                            <h6 class="text-secondary">
                                                <i class="fas fa-home me-2"></i>Homework Assignment
                                            </h6>
                                            <div class="alert alert-info">
                                                <i class="fas fa-clipboard-list me-2"></i>
                                                {{ day.homework }}
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                {% if day.content_summary %}
                                <div class="mt-4 pt-3 border-top">
                                    <h6 class="text-muted">
                                        <i class="fas fa-file-alt me-2"></i>Content Summary
                                    </h6>
                                    <p class="text-muted mb-0">{{ day.content_summary }}</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Final Project and Resources -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-project-diagram me-2"></i>
                                Final Project
                            </h5>
                        </div>
                        <div class="card-body">
                            <p>{{ course.final_project }}</p>
                            {% if course.assessment_criteria %}
                            <h6>Assessment Criteria:</h6>
                            <p class="text-muted">{{ course.assessment_criteria }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-external-link-alt me-2"></i>
                                Additional Resources
                            </h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled">
                                {% for resource in course.resources %}
                                <li class="mb-2">
                                    <i class="fas fa-link text-primary me-2"></i>{{ resource }}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Processing Details -->
            <div class="row">
                <div class="col-12">
                    <div class="card border-secondary">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-chart-bar me-2"></i>
                                Processing Details & Reliability Metrics
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-4">
                                <div class="col-md-4">
                                    <h6>Metadata Extraction</h6>
                                    <div class="metric-details">
                                        <div class="metric-row">
                                            <span>YouTube API:</span>
                                            <span class="{% if metrics.api_success.youtube_api %}text-success{% else %}text-danger{% endif %}">
                                                {% if metrics.api_success.youtube_api %}✓{% else %}✗{% endif %}
                                            </span>
                                        </div>
                                        <div class="metric-row">
                                            <span>Backup API:</span>
                                            <span class="{% if metrics.api_success.backup_api %}text-success{% else %}text-danger{% endif %}">
                                                {% if metrics.api_success.backup_api %}✓{% else %}✗{% endif %}
                                            </span>
                                        </div>
                                        <div class="metric-row">
                                            <span>Web Scraper:</span>
                                            <span class="{% if metrics.api_success.scraper %}text-success{% else %}text-danger{% endif %}">
                                                {% if metrics.api_success.scraper %}✓{% else %}✗{% endif %}
                                            </span>
                                        </div>
                                        <div class="metric-row fw-bold">
                                            <span>Success Rate:</span>
                                            <span>{{ "%.1f"|format(metrics.api_success.metadata_success_rate * 100) }}%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <h6>Transcript Extraction</h6>
                                    <div class="metric-details">
                                        <div class="metric-row">
                                            <span>Apify:</span>
                                            <span class="{% if metrics.transcript_success.apify %}text-success{% else %}text-danger{% endif %}">
                                                {% if metrics.transcript_success.apify %}✓{% else %}✗{% endif %}
                                            </span>
                                        </div>
                                        <div class="metric-row">
                                            <span>YouTube Transcript:</span>
                                            <span class="{% if metrics.transcript_success.youtube_transcript %}text-success{% else %}text-danger{% endif %}">
                                                {% if metrics.transcript_success.youtube_transcript %}✓{% else %}✗{% endif %}
                                            </span>
                                        </div>
                                        <div class="metric-row">
                                            <span>Backup Service:</span>
                                            <span class="{% if metrics.transcript_success.backup_transcript %}text-success{% else %}text-danger{% endif %}">
                                                {% if metrics.transcript_success.backup_transcript %}✓{% else %}✗{% endif %}
                                            </span>
                                        </div>
                                        <div class="metric-row fw-bold">
                                            <span>Success Rate:</span>
                                            <span>{{ "%.1f"|format(metrics.transcript_success.transcript_success_rate * 100) }}%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <h6>AI Generation</h6>
                                    <div class="metric-details">
                                        <div class="metric-row">
                                            <span>OpenRouter GPT-4:</span>
                                            <span class="{% if metrics.ai_success.openrouter %}text-success{% else %}text-danger{% endif %}">
                                                {% if metrics.ai_success.openrouter %}✓{% else %}✗{% endif %}
                                            </span>
                                        </div>
                                        <div class="metric-row">
                                            <span>Claude 3.5:</span>
                                            <span class="{% if metrics.ai_success.claude %}text-success{% else %}text-danger{% endif %}">
                                                {% if metrics.ai_success.claude %}✓{% else %}✗{% endif %}
                                            </span>
                                        </div>
                                        <div class="metric-row">
                                            <span>Fallback Generator:</span>
                                            <span class="{% if metrics.ai_success.fallback_generator %}text-success{% else %}text-danger{% endif %}">
                                                {% if metrics.ai_success.fallback_generator %}✓{% else %}✗{% endif %}
                                            </span>
                                        </div>
                                        <div class="metric-row fw-bold">
                                            <span>Success Rate:</span>
                                            <span>{{ "%.1f"|format(metrics.ai_success.ai_success_rate * 100) }}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {% if false %}
                            <div class="mt-4">
                                <h6>Quality Metrics</h6>
                                <div class="row">
                                    {% if false %}
                                    <div class="col-md-6">
                                        <strong>Errors ({{ metrics.quality_metrics.errors_count }}):</strong>
                                        <div class="small text-danger mt-1">
                                            {% for error in metrics.quality_metrics.errors %}
                                            <div>{{ error.timestamp[:19] }}: {{ error.error }}</div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                    {% if false %}
                                    <div class="col-md-6">
                                        <strong>Warnings ({{ metrics.quality_metrics.warnings_count }}):</strong>
                                        <div class="small text-warning mt-1">
                                            {% for warning in metrics.quality_metrics.warnings %}
                                            <div>{{ warning.timestamp[:19] }}: {{ warning.warning }}</div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Export Options -->
            <div class="row mt-4">
                <div class="col-12 text-center">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-primary" onclick="downloadJSON()">
                            <i class="fas fa-download me-2"></i>
                            Download JSON
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="printCourse()">
                            <i class="fas fa-print me-2"></i>
                            Print Course
                        </button>
                        <button type="button" class="btn btn-outline-info" onclick="shareCourse()">
                            <i class="fas fa-share me-2"></i>
                            Share Course
                        </button>
                        <button type="button" class="btn btn-outline-warning" onclick="showEmbedCode()">
                            <i class="fas fa-code me-2"></i>
                            Embed Course
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Embed Code Modal -->
        <div class="modal fade" id="embedModal" tabindex="-1" aria-labelledby="embedModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="embedModalLabel">
                            <i class="fas fa-code me-2"></i>
                            Embed Course Code
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p class="text-muted">Copy and paste this iframe code to embed the course on your website:</p>
                        <div class="mb-3">
                            <label for="embedCode" class="form-label">Iframe Embed Code</label>
                            <textarea class="form-control" id="embedCode" rows="4" readonly></textarea>
                        </div>
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-primary" onclick="copyEmbedCode()">
                                <i class="fas fa-copy me-2"></i>Copy to Clipboard
                            </button>
                            <small class="text-muted align-self-center">
                                <i class="fas fa-info-circle me-1"></i>
                                Responsive and mobile-friendly
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center py-4 mt-5 border-top">
            <p class="text-muted mb-0">
                <i class="fas fa-shield-alt me-1"></i>
                Generated with enterprise-grade reliability
            </p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Course data for JavaScript functions
        const courseData = {
            mp4_video_url: "{{ video_info.mp4_video_url|default('') }}",
            mp4_download_status: "{{ video_info.mp4_download_status|default('') }}",
            mp4_file_size: {{ video_info.mp4_file_size|default(0) }},
            cloudinary_url: "{{ video_info.cloudinary_url|default('') }}",
            video_id: "{{ video_info.video_id|default('') }}",
            course_title: "{{ course.course_title|default('')|escape }}",
            course_id: {{ course.id|default(0) }}
        };
        const metricsData = {{ metrics|tojson|safe }};
        
        // Debug: Log course data to console for troubleshooting
        console.log('Course Data:', courseData);
        console.log('MP4 Video URL:', courseData?.mp4_video_url);
        console.log('MP4 Download Status:', courseData?.mp4_download_status);
        
        // Video debugging - check video loading when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // All content permanently visible - no initialization needed
            
            const video = document.querySelector('video');
            if (video) {
                console.log('Video element found:', video.src);
                
                video.addEventListener('loadstart', function() {
                    console.log('Video loading started');
                });
                
                video.addEventListener('loadeddata', function() {
                    console.log('Video data loaded successfully');
                });
                
                video.addEventListener('error', function(e) {
                    console.error('Video loading error:', e);
                    console.error('Video error details:', this.error);
                    
                    // Show user-friendly error message
                    const videoContainer = this.parentElement;
                    videoContainer.innerHTML = `
                        <div class="alert alert-warning h-100 d-flex align-items-center justify-content-center">
                            <div class="text-center">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Video Playback Error</strong>
                                <p class="mb-2 mt-2">The video file cannot be played in the browser.</p>
                                <a href="${this.src}" target="_blank" class="btn btn-outline-warning btn-sm">
                                    <i class="fas fa-external-link-alt me-1"></i>Try Direct Link
                                </a>
                                <a href="${this.src}" download class="btn btn-outline-primary btn-sm ms-2">
                                    <i class="fas fa-download me-1"></i>Download File
                                </a>
                            </div>
                        </div>
                    `;
                });
                
                video.addEventListener('canplay', function() {
                    console.log('Video is ready to play');
                });
            } else {
                console.log('No video element found on page');
            }
            
            // Debug: Check for navigation issues
            const navigationLinks = document.querySelectorAll('a[href]');
            navigationLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    console.log('Navigation clicked:', this.href);
                    
                    // Check for problematic redirects
                    if (this.href.includes('login') || this.href.includes('signin')) {
                        console.warn('Detected potential redirect to login page:', this.href);
                        e.preventDefault();
                        alert('Navigation issue detected. This link appears to redirect to a login page.');
                        return false;
                    }
                });
            });
            
            // Initialize processing logs fetching if session ID is available
            const sessionId = '{{ session_id }}';
            console.log('Session ID for logs:', sessionId);
            if (sessionId && sessionId !== 'None' && sessionId !== '') {
                fetchProcessingLogs(sessionId);
                
                // Set up real-time fetching
                setInterval(() => {
                    fetchProcessingLogs(sessionId);
                }, 3000);
            } else {
                console.log('No session ID available for log fetching');
                // Show default message in logs container
                const logsContainer = document.getElementById('processingLogs');
                if (logsContainer) {
                    logsContainer.innerHTML = `
                        <div class="text-info text-center p-3">
                            <i class="fas fa-info-circle me-2"></i>
                            Processing completed successfully - logs are available in console
                        </div>
                    `;
                }
            }
        });

        function downloadJSON() {
            const data = {
                course: courseData,
                metrics: metricsData,
                generated_at: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `youtube-course-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function printCourse() {
            window.print();
        }
        
        function fetchProcessingLogs(sessionId) {
            if (!sessionId) return;
            
            console.log('Fetching logs for session:', sessionId);
            fetch(`/api/logs/${sessionId}`)
                .then(response => response.json())
                .then(data => {
                    console.log('Logs API response:', data);
                    if (data.success && data.logs && data.logs.length > 0) {
                        console.log('Displaying', data.logs.length, 'logs');
                        displayProcessingLogs(data.logs);
                    } else {
                        console.log('No logs found, showing default message');
                        // Show basic processing completed message if no logs
                        const logsContainer = document.getElementById('processingLogs');
                        if (logsContainer) {
                            logsContainer.innerHTML = `
                                <div class="text-success text-center p-3">
                                    <i class="fas fa-check-circle me-2"></i>
                                    Course generation completed successfully!
                                </div>
                            `;
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching processing logs:', error);
                    const logsContainer = document.getElementById('processingLogs');
                    if (logsContainer) {
                        logsContainer.innerHTML = `
                            <div class="text-danger text-center p-3">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Error loading logs: ${error.message}
                            </div>
                        `;
                    }
                });
        }
        
        function displayProcessingLogs(logs) {
            const logsContainer = document.getElementById('processingLogs');
            console.log('Logs container found:', !!logsContainer);
            if (!logsContainer) {
                console.error('processingLogs container not found');
                return;
            }
            
            // Group logs by categories for better troubleshooting
            const categories = {
                'execution': ['Course Generation', 'Database', 'Performance'],
                'apis': ['YouTube API', 'OpenAI API', 'Claude API', 'Apify API'],
                'downloads': ['MP4 Download', 'Cloudinary Upload'],
                'fallbacks': ['Fallback System', 'YouTube Downloader'],
                'errors': logs.filter(log => log.level === 'ERROR' || log.status === 'FAILED')
            };
            
            const logsHtml = logs.map(log => {
                const statusClass = log.level === 'ERROR' ? 'text-danger' : 
                                  log.level === 'WARNING' ? 'text-warning' : 
                                  log.status === 'SUCCESS' ? 'text-success' : 
                                  log.status === 'FAILED' ? 'text-danger' :
                                  log.status === 'ACTIVATED' ? 'text-warning' : 'text-info';
                
                const timestamp = new Date(log.timestamp).toLocaleTimeString();
                const step = log.step || log.step_name || 'Unknown';
                const details = log.details || log.message || '';
                
                // Extract troubleshooting metadata from details
                const metadataMatch = details.match(/\|(.*)/);
                const mainMessage = metadataMatch ? details.split('|')[0].trim() : details;
                const metadata = metadataMatch ? metadataMatch[1].trim() : '';
                
                return `
                    <div class="log-entry mb-2 p-2 border-start border-3 ${statusClass}" data-step="${step}" data-level="${log.level}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <strong>${step}</strong>
                                <span class="badge ${statusClass.includes('danger') ? 'bg-danger' : 
                                                   statusClass.includes('warning') ? 'bg-warning' : 
                                                   statusClass.includes('success') ? 'bg-success' : 'bg-secondary'} ms-2">
                                    ${log.status}
                                </span>
                                ${log.level === 'ERROR' ? '<i class="fas fa-exclamation-triangle text-danger ms-1"></i>' : ''}
                                ${log.status === 'ACTIVATED' ? '<i class="fas fa-shield-alt text-warning ms-1"></i>' : ''}
                            </div>
                            <small class="text-muted">${timestamp}</small>
                        </div>
                        <div class="mt-1">
                            <div class="text-light">${mainMessage}</div>
                            ${metadata ? `<div class="mt-1 small text-muted font-monospace">${metadata}</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add summary statistics for troubleshooting
            const totalLogs = logs.length;
            const errors = logs.filter(log => log.level === 'ERROR' || log.status === 'FAILED').length;
            const warnings = logs.filter(log => log.level === 'WARNING').length;
            const successes = logs.filter(log => log.status === 'SUCCESS').length;
            const fallbacks = logs.filter(log => log.status === 'ACTIVATED').length;
            
            const summaryHtml = `
                <div class="log-summary mb-3 p-2 bg-dark border rounded">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-muted small">Processing Summary:</span>
                        <div class="small">
                            <span class="badge bg-success me-1">${successes} Success</span>
                            <span class="badge bg-warning me-1">${warnings} Warnings</span>
                            <span class="badge bg-danger me-1">${errors} Errors</span>
                            ${fallbacks > 0 ? `<span class="badge bg-info">${fallbacks} Fallbacks</span>` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            logsContainer.innerHTML = summaryHtml + logsHtml;
            
            // Add filtering buttons for troubleshooting
            const filterButtons = `
                <div class="log-filters mb-2">
                    <button class="btn btn-sm btn-outline-secondary me-1" onclick="filterLogs('all')">All</button>
                    <button class="btn btn-sm btn-outline-danger me-1" onclick="filterLogs('error')">Errors</button>
                    <button class="btn btn-sm btn-outline-warning me-1" onclick="filterLogs('warning')">Warnings</button>
                    <button class="btn btn-sm btn-outline-info me-1" onclick="filterLogs('api')">APIs</button>
                    <button class="btn btn-sm btn-outline-primary" onclick="filterLogs('performance')">Performance</button>
                </div>
            `;
            
            logsContainer.insertAdjacentHTML('afterbegin', filterButtons);
        }
        
        function filterLogs(type) {
            const logEntries = document.querySelectorAll('.log-entry');
            logEntries.forEach(entry => {
                const level = entry.dataset.level;
                const step = entry.dataset.step;
                let show = false;
                
                switch(type) {
                    case 'all':
                        show = true;
                        break;
                    case 'error':
                        show = level === 'ERROR' || entry.classList.contains('text-danger');
                        break;
                    case 'warning':
                        show = level === 'WARNING' || entry.classList.contains('text-warning');
                        break;
                    case 'api':
                        show = step.includes('API') || step.includes('Download') || step.includes('Upload');
                        break;
                    case 'performance':
                        show = step.includes('Performance') || step.includes('Duration') || step.includes('Speed');
                        break;
                }
                
                entry.style.display = show ? 'block' : 'none';
            });
        }

        function shareCourse() {
            if (navigator.share) {
                navigator.share({
                    title: courseData.course_title,
                    text: courseData.course_description,
                    url: window.location.href
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('Course URL copied to clipboard!');
                });
            }
        }

        function showEmbedCode() {
            const courseId = window.location.pathname.split('/').pop();
            const baseUrl = window.location.origin;
            const embedUrl = `${baseUrl}/courses/${courseId}?embed=true`;
            
            const embedCode = `<iframe 
    src="${embedUrl}" 
    width="100%" 
    height="800" 
    frameborder="0" 
    style="border: 1px solid #ddd; border-radius: 8px;"
    title="YouTube Course: ${courseData.course_title || 'Course'}"
    allowfullscreen>
</iframe>`;

            document.getElementById('embedCode').value = embedCode;
            const modal = new bootstrap.Modal(document.getElementById('embedModal'));
            modal.show();
        }

        function copyEmbedCode() {
            const embedCode = document.getElementById('embedCode');
            embedCode.select();
            embedCode.setSelectionRange(0, 99999); // For mobile devices
            
            navigator.clipboard.writeText(embedCode.value).then(() => {
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check me-2"></i>Copied!';
                button.classList.remove('btn-primary');
                button.classList.add('btn-success');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('btn-success');
                    button.classList.add('btn-primary');
                }, 2000);
            }).catch(err => {
                alert('Failed to copy to clipboard. Please select and copy manually.');
            });
        }

        // Initialize Video.js player if MP4 video is available
        {% if video_info.mp4_video_url %}
        document.addEventListener('DOMContentLoaded', function() {
            const player = videojs('course-video', {
                responsive: true,
                fluid: true,
                playbackRates: [0.5, 1, 1.25, 1.5, 2],
                controls: true,
                preload: 'auto'
            });
            
            player.on('error', function() {
                console.error('Video playback error occurred');
                const errorMsg = document.createElement('div');
                errorMsg.className = 'alert alert-warning mt-3';
                errorMsg.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>Video playback failed. <a href="{{ video_info.mp4_video_url }}" target="_blank" class="btn btn-sm btn-outline-warning ms-2">Try Direct Link</a>';
                player.el().parentNode.appendChild(errorMsg);
            });
        });
        {% endif %}

        // Function to check MP4 download status
        function checkMP4Status(runId) {
            if (!runId) return;
            
            fetch(`/api/apify/status?run_id=${runId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'SUCCEEDED' && data.mp4_url) {
                        // Refresh the page to show the MP4 video
                        window.location.reload();
                    } else if (data.status === 'FAILED') {
                        alert('MP4 download failed. Please try generating the course again.');
                    } else {
                        alert(`MP4 download status: ${data.status}. Please check back in a few minutes.`);
                    }
                })
                .catch(error => {
                    console.error('Error checking MP4 status:', error);
                    alert('Error checking download status. Please try again.');
                });
        }

        // Processing Logs functionality
        let autoScroll = true;
        const logOutput = document.getElementById('logOutput');
        let logFetchInterval;
        
        // Function to fetch real-time processing logs
        function fetchProcessingLogs() {
            const sessionId = '{{ session_id }}';
            if (!sessionId || sessionId === 'None') {
                return;
            }
            
            fetch(`/api/logs/${sessionId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.logs && data.logs.length > 0) {
                        // Clear existing static logs first time we get real data
                        if (logOutput.children.length > 0 && logOutput.children[0].textContent.includes('No processing logs available')) {
                            logOutput.innerHTML = '';
                        }
                        
                        // Clear and rebuild log output to prevent duplicates
                        logOutput.innerHTML = '';
                        
                        data.logs.forEach(log => {
                            const logEntry = document.createElement('div');
                            logEntry.className = 'log-entry';
                            
                            const timestamp = log.timestamp ? log.timestamp.slice(0, 19) : 'N/A';
                            
                            let logLevel = '';
                            let iconClass = 'info-circle';
                            
                            if (log.level === 'ERROR' || log.status === 'FAILED') {
                                logLevel = 'text-danger';
                                iconClass = 'exclamation-triangle';
                            } else if (log.level === 'WARNING') {
                                logLevel = 'text-warning';
                                iconClass = 'exclamation-circle';
                            } else if (log.status === 'SUCCESS') {
                                logLevel = 'text-success';
                                iconClass = 'check';
                            } else if (log.status === 'RUNNING') {
                                logLevel = 'text-primary';
                                iconClass = 'clock';
                            } else {
                                logLevel = 'text-info';
                            }
                            
                            // Customize icons based on step type
                            if (log.step && (log.step.includes('MP4') || log.step.includes('Apify'))) {
                                iconClass = 'download';
                            } else if (log.step && log.step.includes('AI')) {
                                iconClass = 'brain';
                            } else if (log.step && log.step.includes('Transcript')) {
                                iconClass = 'file-alt';
                            } else if (log.step && log.step.includes('Video')) {
                                iconClass = 'video';
                            }
                            
                            logEntry.innerHTML = `
                                <span class="log-timestamp text-secondary">${timestamp}</span>
                                <span class="log-message ${logLevel}">
                                    <i class="fas fa-${iconClass} me-1"></i>
                                    ${log.step}: ${log.status}${log.details ? ' - ' + log.details : ''}
                                </span>
                            `;
                            
                            logOutput.appendChild(logEntry);
                        });
                        
                        if (autoScroll) {
                            logOutput.scrollTop = logOutput.scrollHeight;
                        }
                    } else if (data.success === false && data.message) {
                        // Show the "No processing logs available" message if no logs exist
                        if (logOutput.children.length === 0) {
                            logOutput.innerHTML = `
                                <div class="log-entry">
                                    <span class="log-timestamp text-secondary">${new Date().toISOString().slice(0, 19)}</span>
                                    <span class="log-message text-info">
                                        <i class="fas fa-info-circle me-1"></i>${data.message}
                                    </span>
                                </div>
                            `;
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching processing logs:', error);
                });
        }
        
        // Start real-time log fetching when page loads
        document.addEventListener('DOMContentLoaded', function() {
            fetchProcessingLogs(); // Initial fetch
            logFetchInterval = setInterval(fetchProcessingLogs, 3000); // Fetch every 3 seconds
        });
        
        // Stop fetching when user leaves page
        window.addEventListener('beforeunload', function() {
            if (logFetchInterval) {
                clearInterval(logFetchInterval);
            }
        });
        
        // Clear logs functionality
        document.getElementById('clearLogsBtn').addEventListener('click', function() {
            if (confirm('Clear all processing logs?')) {
                logOutput.innerHTML = '<div class="text-muted"><i class="fas fa-info-circle me-2"></i>Logs cleared by user</div>';
                // Stop auto-fetching after manual clear
                if (logFetchInterval) {
                    clearInterval(logFetchInterval);
                }
            }
        });
        
        // Toggle auto-scroll functionality
        document.getElementById('toggleAutoScrollBtn').addEventListener('click', function() {
            autoScroll = !autoScroll;
            const button = this;
            const icon = button.querySelector('i');
            
            if (autoScroll) {
                button.classList.remove('btn-outline-warning');
                button.classList.add('btn-outline-light');
                icon.className = 'fas fa-arrow-down me-1';
                button.innerHTML = '<i class="fas fa-arrow-down me-1"></i>Auto-scroll';
                logOutput.scrollTop = logOutput.scrollHeight;
            } else {
                button.classList.remove('btn-outline-light');
                button.classList.add('btn-outline-warning');
                icon.className = 'fas fa-pause me-1';
                button.innerHTML = '<i class="fas fa-pause me-1"></i>Paused';
            }
        });
        
        // Refresh logs functionality (check for MP4 updates)
        document.getElementById('refreshLogsBtn').addEventListener('click', function() {
            {% if video_info.run_id %}
            const button = this;
            const originalHTML = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Checking...';
            button.disabled = true;
            
            fetch('/api/apify/status?run_id={{ video_info.run_id }}')
                .then(response => response.json())
                .then(data => {
                    const newLogEntry = document.createElement('div');
                    newLogEntry.className = 'log-entry';
                    newLogEntry.innerHTML = `
                        <span class="log-timestamp text-secondary">${new Date().toISOString().slice(0, 19)}</span>
                        <span class="log-message ${data.status === 'SUCCEEDED' ? 'text-success' : data.status === 'FAILED' ? 'text-danger' : 'text-info'}">
                            <i class="fas fa-${data.status === 'SUCCEEDED' ? 'check' : data.status === 'FAILED' ? 'times' : 'clock'} me-1"></i>
                            MP4 Status: ${data.status}${data.mp4_url ? ' - Video ready!' : ''}
                        </span>
                    `;
                    
                    logOutput.appendChild(newLogEntry);
                    
                    if (autoScroll) {
                        logOutput.scrollTop = logOutput.scrollHeight;
                    }
                    
                    if (data.status === 'SUCCEEDED' && data.mp4_url) {
                        setTimeout(() => {
                            if (confirm('MP4 video is ready! Refresh page to view the video player?')) {
                                window.location.reload();
                            }
                        }, 1000);
                    }
                })
                .catch(error => {
                    console.error('Error checking MP4 status:', error);
                    const errorLogEntry = document.createElement('div');
                    errorLogEntry.className = 'log-entry';
                    errorLogEntry.innerHTML = `
                        <span class="log-timestamp text-secondary">${new Date().toISOString().slice(0, 19)}</span>
                        <span class="log-message text-danger">
                            <i class="fas fa-exclamation-triangle me-1"></i>Error checking MP4 status
                        </span>
                    `;
                    logOutput.appendChild(errorLogEntry);
                })
                .finally(() => {
                    button.innerHTML = originalHTML;
                    button.disabled = false;
                });
            {% else %}
            const newLogEntry = document.createElement('div');
            newLogEntry.className = 'log-entry';
            newLogEntry.innerHTML = `
                <span class="log-timestamp text-secondary">${new Date().toISOString().slice(0, 19)}</span>
                <span class="log-message text-info">
                    <i class="fas fa-info-circle me-1"></i>No MP4 download in progress for this course
                </span>
            `;
            logOutput.appendChild(newLogEntry);
            
            if (autoScroll) {
                logOutput.scrollTop = logOutput.scrollHeight;
            }
            {% endif %}
        });
        
        // Auto-scroll to bottom on page load
        if (autoScroll && logOutput) {
            logOutput.scrollTop = logOutput.scrollHeight;
        }
    </script>

    <!-- Video.js JavaScript for better video player -->
    <script src="https://vjs.zencdn.net/8.7.0/video.min.js"></script>
</body>
</html>
